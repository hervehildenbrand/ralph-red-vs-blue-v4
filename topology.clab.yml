# Ralph Red vs Blue v3 - Reduced Topology (18 nodes)
# 2 Route Reflectors, 4 Core (P) routers, 6 Provider Edge (PE), 6 Customer Edge (CE)
# 3 VRFs: ALPHA, BETA, GAMMA

name: red-vs-blue-v3

topology:
  defaults:
    kind: ceos
    image: ceos:4.35.1F

  nodes:
    # === Route Reflectors ===
    rr1:
      startup-config: configs/baseline/rr1.cfg
    rr2:
      startup-config: configs/baseline/rr2.cfg

    # === Core (P) Routers ===
    p1:
      startup-config: configs/baseline/p1.cfg
    p2:
      startup-config: configs/baseline/p2.cfg
    p3:
      startup-config: configs/baseline/p3.cfg
    p4:
      startup-config: configs/baseline/p4.cfg

    # === Provider Edge (PE) Routers ===
    # Site 1 PEs
    pe1:
      startup-config: configs/baseline/pe1.cfg
    pe2:
      startup-config: configs/baseline/pe2.cfg
    pe3:
      startup-config: configs/baseline/pe3.cfg
    # Site 2 PEs
    pe4:
      startup-config: configs/baseline/pe4.cfg
    pe5:
      startup-config: configs/baseline/pe5.cfg
    pe6:
      startup-config: configs/baseline/pe6.cfg

    # === Customer Edge (CE) Hosts ===
    ce1:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.1.2/24 dev eth1
        - ip addr add 2001:db8:1::2/64 dev eth1
        - ip route add 192.168.4.0/24 via 192.168.1.1
        - ip -6 route add 2001:db8:4::/64 via 2001:db8:1::1

    ce2:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.2.2/24 dev eth1
        - ip addr add 2001:db8:2::2/64 dev eth1
        - ip route add 192.168.5.0/24 via 192.168.2.1
        - ip -6 route add 2001:db8:5::/64 via 2001:db8:2::1

    ce3:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.3.2/24 dev eth1
        - ip addr add 2001:db8:3::2/64 dev eth1
        - ip route add 192.168.6.0/24 via 192.168.3.1
        - ip -6 route add 2001:db8:6::/64 via 2001:db8:3::1

    ce4:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.4.2/24 dev eth1
        - ip addr add 2001:db8:4::2/64 dev eth1
        - ip route add 192.168.1.0/24 via 192.168.4.1
        - ip -6 route add 2001:db8:1::/64 via 2001:db8:4::1

    ce5:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.5.2/24 dev eth1
        - ip addr add 2001:db8:5::2/64 dev eth1
        - ip route add 192.168.2.0/24 via 192.168.5.1
        - ip -6 route add 2001:db8:2::/64 via 2001:db8:5::1

    ce6:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.6.2/24 dev eth1
        - ip addr add 2001:db8:6::2/64 dev eth1
        - ip route add 192.168.3.0/24 via 192.168.6.1
        - ip -6 route add 2001:db8:3::/64 via 2001:db8:6::1

  links:
    # === RR Interconnect ===
    - endpoints: ["rr1:eth1", "rr2:eth1"]

    # === RR to P Connections ===
    - endpoints: ["rr1:eth2", "p1:eth1"]
    - endpoints: ["rr1:eth3", "p2:eth1"]
    - endpoints: ["rr2:eth2", "p3:eth1"]
    - endpoints: ["rr2:eth3", "p4:eth1"]

    # === Core Ring (P1-P2-P3-P4-P1) ===
    - endpoints: ["p1:eth2", "p2:eth2"]
    - endpoints: ["p2:eth3", "p3:eth2"]
    - endpoints: ["p3:eth3", "p4:eth2"]
    - endpoints: ["p4:eth3", "p1:eth3"]

    # === Cross-connects ===
    - endpoints: ["p1:eth4", "p3:eth4"]
    - endpoints: ["p2:eth4", "p4:eth4"]

    # === PE to P Connections (Site 1) ===
    - endpoints: ["p1:eth5", "pe1:eth1"]
    - endpoints: ["p1:eth6", "pe2:eth1"]
    - endpoints: ["p2:eth5", "pe2:eth2"]
    - endpoints: ["p2:eth6", "pe3:eth1"]

    # === PE to P Connections (Site 2) ===
    - endpoints: ["p3:eth5", "pe4:eth1"]
    - endpoints: ["p3:eth6", "pe5:eth1"]
    - endpoints: ["p4:eth5", "pe5:eth2"]
    - endpoints: ["p4:eth6", "pe6:eth1"]

    # === PE to CE Connections ===
    - endpoints: ["pe1:eth3", "ce1:eth1"]
    - endpoints: ["pe2:eth3", "ce2:eth1"]
    - endpoints: ["pe3:eth3", "ce3:eth1"]
    - endpoints: ["pe4:eth3", "ce4:eth1"]
    - endpoints: ["pe5:eth3", "ce5:eth1"]
    - endpoints: ["pe6:eth3", "ce6:eth1"]
